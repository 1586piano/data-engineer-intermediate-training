<source>
    @type http
    port 9880
    bind 0.0.0.0
    tag input.debug
</source>

<source>
  @type           mysql_query
  host            mysql               # Optional (default: localhost)
  port            3306                # Optional (default: 3306)
  # socket          /var/run/mysqld/mysqld.sock # Optional (default: the host's MySQL library default)
  # username        user                # Optional (default: root)
  # password        pass                # Optional (default nopassword)
  interval        5s                 # Optional (default: 1m)
  tag             input.mysql         # Required
  query           select category, id, name from testdb.seoul_popular_trip limit 1 # Required
  # record_hostname yes                 # Optional (default: no)
  # nest_result     yes                 # Optional (default: no)
  # nest_key        data                # Optional (default: result)
  # row_count       yes                 # Optional (default: no)
  # row_count_key   row_count           # Optional (default: row_count)
</source>

<filter input.mysql>
  @type record_modifier
  char_encoding utf-8
</filter>

<match input.debug>
  @type stdout
  <format>
    localtime true
    timezone Asia/Seoul
  </format>
</match>

<match input.mysql>
  @type file
  @id out_file_0
  path "/fluentd/target/${tag}/%Y/%m/%d/mysql.%H%M"
  <buffer time,tag>
    timekey 1m
    timekey_use_utc false
    timekey_wait 10s
  </buffer>
</match>
